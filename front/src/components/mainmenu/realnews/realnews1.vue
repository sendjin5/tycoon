<template>
  <div class="main-container">
    <div class="date-box">
      <div class="date-text">DAY-{{ gameDay }} NEWS</div>
    </div>
    <div class="dialog-box" @click="movePage">
      <div class="dialog-text" v-html="inputText"></div>
      <div class="dialog-arrow">▼</div>
    </div>
  </div>
</template>

<script>
import Poorending1 from "../ending/poorending1.vue";

export default {
  name: "poorending",
  data() {
    return {
      inputText: "",
      userId: sessionStorage.getItem("loginUser")
        ? JSON.parse(sessionStorage.getItem("loginUser")).userId
        : "",
      dialInterval: "",
      dialog: "",
      dialex: [],
      newsdialnum: 0,
      dialpoint: 0,
      gameDay: null,
      // timeouts: [], setTimeout 초기화화
    };
  },
  async mounted() {
    try {
      // ✅ 백엔드에서 뉴스 데이터 가져오기
      const response = await fetch(__apiUrl__ + "/maingame/news?userId=" + this.userId);
      if (!response.ok) throw new Error("뉴스 데이터를 불러오는데 실패했습니다.");
      const data = await response.json();

      this.gameDay = data;

      // ✅ 게임 회차에 맞는 텍스트 배열을 설정
      this.setNewsText(data);

      // ✅ 타이핑 애니메이션 적용
      this.animateText(this.dialex[this.newsdialnum]); // 첫 번째 텍스트부터 애니메이션
    } catch (error) {
      console.error("에러 발생:", error);
    }
  },
  methods: {
    movePage() {
      // dialpoint를 증가시켜서 다음 텍스트를 보여줌
      if (this.dialpoint < this.dialex.length - 1) {
        this.dialpoint++;
        this.animateText(this.dialex[this.dialpoint]);
      } else {
        // 모든 텍스트를 다 표시한 후 추가로 할 작업 (예: 게임 진행 등)
        console.log("모든 뉴스 텍스트가 출력되었습니다.");
        this.$router.push("/maingame/1");
      }
    },
    // switch 문을 이용하여 게임 회차에 따라 dialex 배열 업데이트
    setNewsText(data) {
      switch (data) {
        case 1:
          this.dialex = [
            "어느 대학에 갈지, 어떤 직업을 선택할지 고민해 본 적이 있나요? 금융에서도 비슷한 고민이 필요합니다.",
            "기회비용 Opportunity Cost이란 한 가지 선택을 했을 때 포기해야 하는 다른 선택의 가치를 의미합니다.",
            "소비자들은 가격이 더 오를 것을 우려해 대량 구매에 나서고 있다고 전해졌습니다.",
            "예를 들어 100만 원을 정기예금에 넣으면 안전하지만 같은 돈을 주식에 투자하면 더 큰 이익을 얻을 수도 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 2:
          this.dialex = [
            "금리는 돈을 빌리는 대가로 지불하는 비용입니다.",
            "한국은행이 기준금리를 조정하면 시중은행의 예금 금리와 대출금리도 변동합니다.",
            "금리가 높아지면 대출 부담이 커지고 저축이 유리해지며 금리가 낮아지면 소비와 투자가 증가합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 3:
          this.dialex = [
            "모든 금융 선택에는 일정한 위험이 따르므로, 금융 상품을 선택할 때는 위험 관리가 필수적입니다.",
            "특히 투자 상품을 선택할 때는 분산 투자(Diversification)를 활용하여 리스크를 줄이는 것이 중요합니다.",
            "하나의 자산에만 집중하면 변동성이 크기 때문에 다양한 금융 상품을 고려하는 것이 바람직합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 4:
          this.dialex = [
            "은행에 가지 않아도 금융 거래가 가능하다고 합니다.",
            "핀테크(Fintech)는 금융(Finance)과 기술(Technology)이 결합한 개념입니다.",
            "모바일 결제, 인터넷 뱅킹, 로보어드바이저(인공지능 투자 상담)등 다양한 서비스가 등장하여 금융 거래가 더욱 편리해지고 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 5:
          this.dialex = [
            "비트코인. NFT(대체 불가능한 토큰)등의 디지털 자산이 투자 수단으로 주목받고 있습니다.",
            "하지만 가격 변동성이 크고 법적 규제가 미비하기 때문에 신중한 접근이 필요합니다.",
            "전문가들은 “전체 자산의 일부만 디지털 자산에 투자하고 리스크를 분산하는 것이 바람직하다”고 조언했습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 6:
          this.dialex = [
            "블록체인 기술은 금융 거래의 보안을 강화하는 혁신적인 기술로 주목받고 있습니다.",
            "탈중앙화 시스템을 기반으로 하여, 해킹이 어려운 장점이 있습니다.",
            "하지만 규제 미비와 시장 변동성이 크다는 단점도 있으므로, 신중한 접근이 필요합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 7:
          this.dialex = [
            "금융 사기를 당했을 경우 즉시 경찰서와 금융감독원에 신고해야 합니다.",
            "또한, 계좌 지급 정지 요청을 통해 추가적인 피해를 예방할 수 있다고 합니다.",
            "전문가들은 “금융 거래 전에는 반드시 공식 기관과 계약을 맺어야 한다”고 강조했습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 8:
          this.dialex = [
            "소득이란 노동이나 투자 활동을 통해 얻은 돈을 의미하며 이에 부과되는 세금이 소득세 입니다.",
            "실질 소득을 계산할 때는 세금과 공제 항목을 고려해야 합니다.",
            "이는 개인이 실제 사용할 수 있는 금액을 결정하는 중요한 요소로 예산 계획 시 반드시 고려해야 합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 9:
          this.dialex = [
            "가처분 소득이란 실직적으로 쓸 수 있는 돈입니다.",
            "가처분 소득은 총 소득에서 세금과 공제액을 제외한 금액을 뜻합니다.",
            "이는 개인이 실제 사용할 수 있는 금액을 결정하는 중요한 요소로 예산 계획 시 반드시 고려해야 합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 10:
          this.dialex = [
            "소득은 근로소득, 사업소득, 금융소득 등 다양한 형태로 발생합니다.",
            "처분 가능 소득은 총소득에서 세금과 공제액을 제외한 금액을 의미합니다.",
            "가계의 실질적인 소비 여력을 판단하기 위해서는 처분 가능 소득을 정확히 계산해야 합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 11:
          this.dialex = [
            "지출은 가계지출, 기타지출, 월말 현금 잔고로 구성됩니다.",
            "가계 지출은 생활에 필요한 소비지출과 세금이나 보험료 같은 비소비지출로 나뉩니다.",
            "예금 가입이나 대출 상환은 기타 지출로 분류되며, 월말 현금 잔고는 지출 후 남은 돈을 의미합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 12:
          this.dialex = [
            "소비 지출은 심리적, 경제적, 문화적 요인 등에 따라 다르게 나타납니다.",
            "반면, 세금이나 보험료 같은 비소비 지출은 정부 정책과 이자율의 영향을 받아 가계가 조정하기 어려운 특징이 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 13:
          this.dialex = [
            "신용카드는 금융회사가 대금을 보증하며 일정 기간 후 결제됩니다. ",
            "체크카드는 구매 즉시 계좌에서 출금되며, 잔액이 부족하면 결제가 불가능합니다.",
            "선불카드는 미리 충전한 금액만큼만 사용할 수 있어 예산을 초과하는 소비를 방지할 수 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 14:
          this.dialex = [
            "예산은 예상 수입을 바탕으로 지출을 계획하는 것입니다.",
            "기업이나 정부뿐만 아니라 가계도 예산을 세워야 안정적인 경제생활을 유지할 수 있습니다.",
            "체계적인 예산 관리는 불필요한 지출을 줄이고 저축과 투자를 효율적으로 할 수 있도록 돕습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 15:
          this.dialex = [
            "예산을 수립하려면 먼저 재무 목표를 설정하고 관리 기간을 정해야 합니다.",
            "실행 후에는 결산을 통해 실제 수입과 지출을 정리하고, 문제점을 평가하여 개선하는 과정이 중요합니다.",
            "체계적인 예산 관리는 재정 안정성을 높이는 데 도움을 줍니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 16:
          this.dialex = [
            "인플레이션이란 상품과 서비스의 전반적인 가격이 지속적으로 상승하는 현상을 말합니다.",
            "인플레이션이 발생하면 화폐의 가치가 하락해 같은 금액으로 살 수 있는 물건의 양이 줄어듭니다.",
            "이는 소비자들의 구매력 감소 로 이어지며, 장기적으로 경제에 다양한 영향을 미칠 수 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 17:
          this.dialex = [
            "요구불 예금은 예금자가 원할 때 언제든 출금할 수 있어 편리하지만, 은행이 장기 대출에 활용하기 어려워 이자가 낮습니다.",
            "재산을 불리는 목적보다는 생활비나 기업 운영 자금을 보관하는 용도로 적합하며, 보통 예금과 당좌 예금 등이 이에 해당합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 18:
          this.dialex = [
            "저축 상품을 선택할 때 이자율이 중요한 이유는 만기에 받을 원리금이 달라지기 때문입니다.",
            "단리는 원금에만 이자가 붙지만, 복리는 이자에도 이자가 붙어 시간이 지날수록 더 많은 수익을 기대할 수 있습니다.",
            "같은 이자율이라도 복리 상품이 장기적으로 유리합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 19:
          this.dialex = [
            "유가증권은 일정한 금전적 가치를 지닌 증서로, 소유권이나 채권을 나타냅니다.",
            "대표적으로 주식과 채권이 있으며, 주식은 기업의 소유권을, 채권은 일정한 이자를 지급받을 권리를 의미합니다.",
            "투자자는 유가증권을 사고팔며 수익을 얻을 수 있지만, 시장 변동에 따라 가치가 달라질 수 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 20:
          this.dialex = [
            "채권 가격은 금리와 반대로 움직입니다. 금리가 상승하면 기존 채권의 금리가 낮아져 수요가 줄고 가격이 하락합니다.",
            "반대로 금리가 하락하면 기존 채권의 금리가 상대적으로 높아져 수요가 증가하고 가격이 상승합니다.",
            "이는 채권이 만기까지 받을 금액이 확정된 상품이기 때문입니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 21:
          this.dialex = [
            "저축과 투자 시 여러 가지 요소들을 고려해야 합니다. 그중에서도 안전성, 수익성, 유동성은 중요한 평가 지표입니다.",
            "안전성은 원금을 보호하고 손실을 최소화하는 것을 의미하며, 수익성은 투자로 얻는 이익을 나타냅니다.",
            "유동성은 현금이 필요한 상황에 대비할 수 있는 정도를 의미하는데, 이 세 가지 요소를 균형 있게 고려하여 저축과 투자 전략을 수립할 필요가 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 22:
          this.dialex = [
            "금융 회사가 영업 정지나 파산 등으로 고객의 예금을 지급하지 못하게 될 경우, 해당 예금자는 물론 전체 시장의 안전성에 큰 타격을 입게 됩니다.",
            "이러한 사태를 방지하기 위하여 〈예금자 보호법〉을 제정하여 고객들의 예금을 보호하는 제도를 갖추어 놓고 있는데, 이를 예금자 보호 제도라고 합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 23:
          this.dialex = [
            "일반적으로 신용은 사람과 사람 사이의 믿음을 의미합니다.",
            "하지만 금융 용어로서 신용은 장래의 어느 시점에 갚을 것을 약속하고 돈을 빌릴 수 있는 능력으로, 개인의 경제 활동에 대한 사회적 평가를 말합니다.",
            "따라서 어떤 사람의 신용이 좋다는 것은 갚을 수 있는 능력이 충분하다는 것을, 반대로 신용이 나쁘다는 것은 갚을 능력이 부족하다는 것을 의미합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 24:
          this.dialex = [
            "신용 정보란 금융 거래 등에서 거래 상대방의 신용을 판단할 때 필요한 정보를 의미합니다.",
            "개인의 신용 정보에는 성명과 주민 등록 번호 등 개인이 누구인가를 알 수 있는 식별 정보, 대출 이력이나 신용 카드 발급 및 해지 이력 등이 담긴 신용 거래 정보,",
            "대출금 연체나 신용 카드 대금 연체 등이 담긴 신용도 판단 정보, 세금 체납 등 공공 기관과 관련된 공공 정보 등이 포함됩니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 25:
          this.dialex = [
            "대출을 받을 때에는 부채 상환 시 적용되는 금리를 고려해야 합니다.",
            "고정 금리는 대출 기간 동안 시중 금리의 변동과 무관하게 약정한 금리가 만기까지 변하지 않고 일정하게 유지되는 방식입니다.",
            "향후 금리 상승을 예상한다면 고정 금리가 유리할 수 있습니다.",
            "변동 금리는 대출 기간 동안 적용되는 금리가 시장 상황에 따라 변화하는 방식입니다.",
            "향후 금리 하락을 예상한다면 변동 금리를 적용받는 것이 유리할 수 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 26:
          this.dialex = [
            "우리가 일상생활에서 직면하는 위험은 다양합니다. 예기치 못한 질병, 사고로 인해 치료와 보호에 필요한 비용을 부담할 뿐만 아니라",
            "장애, 사망 등 일할 능력을 상실하여 소득이 감소하는 등 큰 비용을 부담하게 될 수 있습니다. 이를 인적 손실 위험이라고 합니다.",
            "또는 자신이 소유하고 있는 집, 자동차 등과 같은 실물 자산이 화재, 도난 등으로 손해를 입어 손실이 발생할 수 있는데, 이를 재산 손실 위험이라고 합니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 27:
          this.dialex = [
            "보험의 종류는 크게 사회 보험과 민영 보험 두 가지로 나눌 수 있습니다.",
            "사회 보험은 위험에 대비하여 국가에서 제공하는 사회 보장 제도이다. 국민연금, 국민 건강 보험, 고용 보험, 산업 재해 보상 보험을 ‘4대 보험’이라고도 합니다.",
            "민영 보험은 개인이나 기업이 리스크에 대비하여 자유롭게 가입하는 보험으로 생명 보험, 손해 보험, 제3 보험 등으로 나눌 수 있습니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 28:
          this.dialex = [
            "국민 건강 보험은 국민의 질병이나 부상에 따른 경제적 어려움을 대비하기 위해 만들어진 사회 보험으로,",
            "국민이 낸 보험료를 국민건강보험공단이 관리·운영하다가 필요시 보험 급여를 제공하여 의료 서비스를 받을 수 있도록 하는 사회 보장 제도이다.",
            "사업장에 고용된 근로자 등에 해당하는 건강 보험 직장 가입자는 가입자와 사업주가 보험료를 50%씩 나누어 부담하며, 지역 가입자는 소득과 재산을 기준으로 하여 보험료가 산출된다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 29:
          this.dialex = [
            "긴 시간 동안 안정적으로 경제생활을 유지하려면 은퇴 이전부터 꾸준히 노후 자금을 마련하기 위해 노력해야 한다.",
            "이를 위해 비교적 안정적이지만 수익성이 낮은 저축부터 안전성은 낮은 편이지만 상대적으로 높은 수익을 기대할 수 있는 주식, 펀드 등에 대한 투자도 고려할 필요가 있다.",
            "또한 갑작스러운 사고나 질병 등으로 목돈이 필요할 때를 대비하여 보험에 가입하거나, 안정적으로 일정한 소득을 보장받을 수 있는 연금 등에도 관심을 기울여야 한다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        case 30:
          this.dialex = [
            "연금은 크게 공적 연금, 퇴직 연금, 개인 연금으로 나눌 수 있다.",
            "공적 연금은 고령화 사회를 대비하여 노후에 기본적인 경제생활이 가능한 소득을 보장하는 것을 목표로 하며,",
            "퇴직 연금과 개인 연금은 노후에 개인이 생각하는 적정한 수준의 생활 수준을 유지하기 위한 자금 확보 및 추가적 보장 등을 위해 도입되었다.",
            "우리나라는 국민들의 노후 소득 보장을 위해 세 가지 연금을 바탕으로 다층적인 체계로 구성되어 있다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
        default:
          this.dialex = [
            "기본 뉴스입니다. 게임을 진행하세요.",
            "무언가 중요한 결정을 내릴 차례입니다.",
            "당신의 미래를 결정할 중요한 순간입니다.",
            "이상으로 오늘의 뉴스 마치겠습니다.",
          ];
          break;
      }
    },
    animateText(text) {
      this.inputText = "";
      for (let i = 0; i < text.length; i++) {
        let timeouts = setTimeout(() => {
          // if (text[i] === "\n") {
          // this.inputText += "<br>";
          // } else {
          this.inputText += text[i];
          // }
        }, i * 40);
      }
    },
    // 텍스트 추가 오류
    // clearAnimation() {
    //   this.timeouts.forEach((timeout) => clearTimeout(timeout));
    //   this.timeouts = [];
    // },
  },
};
</script>

<style scoped>
@font-face {
  font-family: "prebold";
  src: url("/fonts/Pretendard-bold.woff") format("woff");
}
.main-container {
  width: 100%;
  height: 100vh;
  position: relative;
  overflow: hidden;
  font-family: pretendard;
  background-color: #f5f5f5;
  max-width: 100%;
  min-height: 90%;
  display: flex;
  background-image: url("/common/news.png");
  background-size: 100% 100%;
}
.dialog-box {
  display: flex;
  justify-content: space-between;
  position: absolute;
  left: 5%;
  bottom: 5%;
  height: 18%;
  width: 90%;
  font-family: prebold;
  font-size: 1.75rem;
  font-display: swap;
  font-weight: bold;
  background-color: #f9f8f2;
  cursor: pointer;
}
.dialog-text {
  width: 90%;
}
.dialog-arrow {
  font-size: 2.4vw;
  width: 30px;
}
.date-box {
  position: absolute;
  top: 10%;
  left: 4%;
  height: 10%;
  width: 30%;
  font-size: 2.7vw;
  font-weight: bold;
  background-color: #ffefca;
  color: #6f3533;
}
</style>
